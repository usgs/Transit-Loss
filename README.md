# Transit-Loss
In an effort to modernize a Fortran transit-loss accounting program developed by the U.S. Geological Survey (USGS) to estimate net reusable flows in Fountain and Monument Creeks in El Paso and Pueblo Counties, Colorado, more than 6000 lines of the FORTRAN77 transit-loss accounting program were revised to comply with the newer Fortran 2003 standard. 

Upgrade to the newer standard involved making changes in formatting and syntax on each line and, when available, adding newer programming constructs that comply with the newer standard. These upgrades produced a more readable Fortran program that helps to prevent accidental mistyping of variables and unintentional changes in named constants during program modification. Program revisions also introduced dynamic array allocation, whole array processing, and handling of input errors to the upgraded transit-loss accounting program.

During the upgrade from FORTRAN77 to the Fortran 2003 standard, incremental revisions were made to the legacy transit-loss Fortran program. The fact that FORTRAN77 is a subset of Fortran 2003 allows both legacy FORTRAN77 statements and upgraded Fortran 2003 statements to be compiled within the same program, making it possible to revise the program incrementally, on a line-by-line basis. This type of incremental change helped mitigate risks of introducing logic errors into the Fortran program that could produce incorrect transit-loss estimates. 

Verification focused on reproducing archived reusable return flows for historical daily runs over a 458-day period extending from May 1, 2015 to July 31, 2016. This date range was selected because it spans the longest continuous period since 2009, when the program input was last modified. Since interim files storing daily streambank losses were not historically archived, no record of antecedent streambank storage losses to hydraulically-connected alluvial deposits was available to provide initial conditions for each daily run. Instead, a Windows batch file was written to loop through all 458 days and execute the transit-loss accounting program on a daily basis. Output from the batch run was used to determine the number of days required for the underlying stream-aquifer model controlling streambank storage losses to no longer be influenced by initial conditions, or “spin-up” period.  Estimated daily reusable return flows from archived output and output generated by the upgraded program were compared only after this “spin-up” period. 

Identity plots of archived daily reusable return flows versus daily reusable return flows estimated by the upgraded program were compared to determine whether the program reproduced historical results and could be considered verified. Daily reusable return flow estimates from the upgraded Fortran program matched those output by the legacy program to within 0.01 cubic feet per second (ft3/s). 
